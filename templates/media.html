{% include 'header.html' %}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header text-center">
                    <h2 class="card-title mb-0">{{ media_item.title }}</h2>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        {% if media_item.file_type == 'image' %}
                        <img src="/api/media/{{ media_item.id }}/download" class="img-fluid rounded" style="max-height: 400px; object-fit: contain;" alt="{{ media_item.title }}">
                        {% elif media_item.file_type == 'audio' %}
                        <audio controls class="w-100">
                            <source src="/api/media/{{ media_item.id }}/download" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                        {% elif media_item.file_type == 'video' %}
                        <video controls class="w-100" style="max-height: 400px;">
                            <source src="/api/media/{{ media_item.id }}/download" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        {% elif media_item.file_type == 'ebook' %}
                            {% if media_item.filename.endswith('.pdf') %}
                            <iframe src="/api/media/{{ media_item.id }}/download" width="100%" height="500px" style="border: none;"></iframe>
                            {% elif media_item.filename.endswith( ('.docx', '.txt') ) %}
                            <p class="text-muted">Document File: Direct viewing not supported. Please <a href="/api/media/{{ media_item.id }}/download">Download {{ media_item.filename }}</a> to view.</p>
                            {% else %}
                            <p class="text-muted">Ebook File: <a href="/api/media/{{ media_item.id }}/download">Download {{ media_item.filename }}</a></p>
                            {% endif %}
                        {% else %}
                        <p class="text-muted">Unsupported media type for direct viewing. Please <a href="/api/media/{{ media_item.id }}/download">Download {{ media_item.filename }}</a>.</p>
                        {% endif %}
                    </div>

                    <p class="card-text"><strong>Description:</strong> {{ media_item.description | default('N/A') }}</p>
                    <hr>
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Tags:</dt>
                        <dd class="col-sm-8">{{ media_item.tags | default('N/A') }}</dd>

                        <dt class="col-sm-4">Category:</dt>
                        <dd class="col-sm-8">{{ media_item.category | default('N/A') }}</dd>

                        <dt class="col-sm-4">Subcategory:</dt>
                        <dd class="col-sm-8">{{ media_item.subcategory | default('N/A') }}</dd>

                        <dt class="col-sm-4">File Type:</dt>
                        <dd class="col-sm-8">{{ media_item.file_type | default('N/A') }}</dd>

                        <dt class="col-sm-4">Upload Date:</dt>
                        <dd class="col-sm-8">{{ media_item.upload_date.strftime('%Y-%m-%d %H:%M') if media_item.upload_date else 'N/A' }}</dd>
                    </dl>
                </div>
                <div class="card-footer text-center">
                    <div class="btn-group" role="group">
                        <a href="/api/media/{{ media_item.id }}/download" class="btn btn-primary">Download</a>
                        <a href="/media/{{ media_item.id }}/edit" class="btn btn-warning">Edit</a>
                        <a href="{{ url_for('add_to_playlist_form', media_id=media_item.id) }}" class="btn btn-info">Add to Playlist</a>
                        <form action="/media/{{ media_item.id }}/delete" method="post" style="display: inline-block;">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                    <div class="mt-2">
                        <a href="/" class="btn btn-secondary">Back to Library</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'footer.html' %}